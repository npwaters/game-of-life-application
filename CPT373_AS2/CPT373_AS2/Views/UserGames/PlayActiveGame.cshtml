@model CPT373_AS2.Models.UserGame

@{
    ViewBag.Title = "PlayActiveGame";
}

<h2>PlayActiveGame</h2>

<div>
    <h4>UserGame</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Name)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Height)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Height)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Width)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Width)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Cells)
        </dt>

        <dd id="cells">
            <pre style="display: inline-block">@Html.DisplayCells(model => model.Cells)</pre> 
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.User.Email)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.User.Email)
        </dd>

    </dl>
</div>
<p>
    @*@Html.ActionLink("Edit", "Edit", new { id = Model.UserGameID }) |*@
    @Html.ActionLink("Back to List", "ListActiveGames")
</p>

@*<p><a class="btn btn-primary btn-lg" id="playGame">Play Game</a></p*@>
<input class="btn btn-primary btn-lg" type="button" id="play" value="Play Active Game"/>



@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var gol = $.connection.golHub;
            // Create a function that the hub can call back to display messages.
            gol.client.addTurnToPage = function (cells) {
                // Add the message to the page.
                $('#cells').html(htmlEncode(cells));
            };

            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#play').click(function () {
                    // Call the PlayActiveGame method on the hub.
                    //gol.server.playActiveGame($('#cells').val());
                    //var game = @Html.Raw(Json.Encode(Model));
                    //var game = @(Model);
                    // http://forums.asp.net/t/2027743.aspx?How+to+pass+JSON+back+and+forth+from+signalr+hub+js+code
                    gol.server.playActiveGame(@Html.Raw(Json.Encode(Model));
                    //alert("Hello!");
                });
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}